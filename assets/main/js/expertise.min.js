import{preloadImages}from"../../libs/utils.js";function animateChessItems(){if($(".banner-expertise").length){var r=document.querySelector(".section-banner.banner-expertise"),a=document.querySelectorAll(".wrapper-chess .chess-item");r&&r.getBoundingClientRect().height;let t=0;a.forEach(e=>{t+=e.getBoundingClientRect().height});r=t+200;let e=document.querySelector(".banner-expertise-spacer");e||((e=document.createElement("div")).classList.add("banner-expertise-spacer"),document.querySelector(".banner-expertise").insertAdjacentElement("afterend",e)),e.style.height=r+"px";a=gsap.utils.toArray(".wrapper-chess .chess-item");gsap.set(a,{y:"120%"});let n=gsap.timeline({scrollTrigger:{trigger:".banner-expertise",start:"top top",end:`+=${r}px`,scrub:!0,pin:!0,pinSpacing:!1}});a.forEach(e=>{n.to(e,{y:"0%",duration:.6,ease:"none"})})}}function buildABrand(){if(!($(".build-a-brand").length<1)){let n=$(".build-a-brand .tab-wrapper .item");function r(e){var t,n=$(`.build-a-brand .wrapper-content .item[data-branding="${e}"]`);0===n.length?console.warn("Không tìm thấy nội dung cho tab "+e):(e=n.find(".h1-heading"),t=n.find(".desc"),n.removeClass("d-none"),n=new SplitText(e,{type:"words,lines",linesClass:"line"}),(e=gsap.timeline()).fromTo(n.lines,{opacity:0,yPercent:100},{opacity:1,yPercent:0,duration:.3,stagger:.1,ease:"expo.out"}),e.fromTo(t,{opacity:0,y:20},{opacity:1,y:0,duration:.4,ease:"expo.out"}))}n.on("click",function(){var e=$(this),t=e.data("branding");e.hasClass("active")||(n.removeClass("active"),e.addClass("active"),(e=$(".build-a-brand .wrapper-content")).find(".item").addClass("d-none"),0===(e=e.find(`.item[data-branding="${t}"]`)).length?console.warn("Không tìm thấy nội dung cho tab "+t):(e.removeClass("d-none"),0<(e=$(".why-choose-us.page-expertise")).length&&(e.find(".main-section").addClass("d-none"),0<(e=e.find(`.main-section[data-branding="${t}"]`)).length?e.removeClass("d-none"):console.warn("Không tìm thấy main-section cho tab "+t)),r(t)))}),ScrollTrigger.create({trigger:".build-a-brand",start:"top 40%",end:"bottom top",markers:!0,onEnter:()=>{var e=$(".build-a-brand .tab-wrapper .item[data-branding='2']");e.hasClass("active")||(n.removeClass("active"),e.addClass("active"),(e=$(".build-a-brand .wrapper-content")).find(".item").addClass("d-none"),e.find(".item[data-branding='2']").removeClass("d-none"),r("2"))},onLeaveBack:()=>{n.removeClass("active"),$(".build-a-brand .wrapper-content .item").addClass("d-none")}})}}function introBrading(){if(!(document.querySelectorAll(".build-a-brand").length<1)){let t=new Lenis,n=(t.on("scroll",()=>ScrollTrigger.update()),e=>{t.raf(1e3*e),requestAnimationFrame(n)}),e=(requestAnimationFrame(n),gsap.registerPlugin(ScrollTrigger,SplitText),document.getElementById("intro-branding")),o=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight,a()});let s=[],d={frame:0},r=0;for(let t=0;t<74;t++){let e=new Image;e.src=`./assets/images/img-chess/chess-${(t+1).toString()}.jpg`,e.onload=()=>{74===++r&&a()},e.onerror=()=>{console.error("Không tải được hình ảnh: "+e.src)},s[t]=e}function a(){var e,t,n,r,a,i;s[d.frame]&&s[d.frame].complete&&(e=s[d.frame],t=o,n=t.canvas,r=n.width/e.width,a=n.height/e.height,r=Math.max(r,a),a=(n.width-e.width*r)/2,i=(n.height-e.height*r)/2,t.clearRect(0,0,n.width,n.height),t.drawImage(e,0,0,e.width,e.height,a,i,e.width*r,e.height*r))}gsap.to(d,{frame:73,snap:"frame",ease:"none",scrollTrigger:{scrub:1,trigger:"#intro-branding",start:"top bottom",end:"bottom top"},onUpdate:a}),gsap.to(".section-intro",{scrollTrigger:{trigger:".section-intro",start:"top top",end:"bottom top",pin:!0,pinSpacing:!1}})}}function showCoreValue(){$(".expertise-core-value").length<1||(gsap.set(".expertise-core-value .content-ovl",{autoAlpha:0}),gsap.timeline({scrollTrigger:{trigger:".expertise-core-value",start:"top 20%",end:"bottom bottom",scrub:!0,onUpdate:e=>{1===e.progress?$(".expertise-core-value .content-ovl").addClass("active"):$(".expertise-core-value .content-ovl").removeClass("active")}}}).to(".expertise-core-value .content-ovl",{autoAlpha:1,y:0,duration:1,ease:"power2.out"}))}let init=()=>{gsap.registerPlugin(ScrollTrigger),animateChessItems(),buildABrand(),introBrading(),showCoreValue()};preloadImages("img").then(()=>{init()}),$(window).on("beforeunload",function(){$(window).scrollTop(0)});