import{preloadImages}from"../../libs/utils.js";function animateChessItems(){if($(".banner-expertise").length){var n=document.querySelector(".section-banner.banner-expertise"),r=document.querySelectorAll(".wrapper-chess .chess-item");n&&n.getBoundingClientRect().height;let t=0;r.forEach(e=>{t+=e.getBoundingClientRect().height});n=window.innerHeight;let e=document.querySelector(".banner-expertise-spacer");e||((e=document.createElement("div")).classList.add("banner-expertise-spacer"),document.querySelector(".banner-expertise").insertAdjacentElement("afterend",e)),e.style.height=n+"px";r=gsap.utils.toArray(".wrapper-chess .chess-item");gsap.set(r,{y:"120%"});let a=gsap.timeline({scrollTrigger:{trigger:".banner-expertise",start:"top top",end:"+=100%",scrub:!0,pin:!0,pinSpacing:!1}});r.forEach(e=>{a.to(e,{y:"0%",duration:.6,ease:"none"})})}}function buildABrand(){if(!($(".build-a-brand").length<1)){let a=$(".build-a-brand .tab-wrapper .item");function n(e){var t,a=$(`.build-a-brand .wrapper-content .item[data-branding="${e}"]`);0===a.length?console.warn("Không tìm thấy nội dung cho tab "+e):(e=a.find(".h1-heading"),t=a.find(".desc"),a.removeClass("d-none"),a=new SplitText(e,{type:"words,lines",linesClass:"line",mask:"lines"}),(e=gsap.timeline()).fromTo(a.lines,{opacity:0,yPercent:100},{opacity:1,yPercent:0,duration:.6,stagger:.13,ease:"expo.out"}),e.fromTo(t,{opacity:0,y:20},{opacity:1,y:0,duration:.4,ease:"expo.out"}))}a.on("click",function(){var e=$(this),t=e.data("branding");e.hasClass("active")||(a.removeClass("active"),e.addClass("active"),(e=$(".build-a-brand .wrapper-content")).find(".item").addClass("d-none"),0===(e=e.find(`.item[data-branding="${t}"]`)).length?console.warn("Không tìm thấy nội dung cho tab "+t):(e.removeClass("d-none"),0<(e=$(".why-choose-us.page-expertise")).length&&(e.find(".main-section").addClass("d-none"),0<(e=e.find(`.main-section[data-branding="${t}"]`)).length?e.removeClass("d-none"):console.warn("Không tìm thấy main-section cho tab "+t)),n(t)))}),ScrollTrigger.create({trigger:".build-a-brand",start:"top 40%",end:"bottom top",onEnter:()=>{var e=$(".build-a-brand .tab-wrapper .item[data-branding='2']");e.hasClass("active")||(a.removeClass("active"),e.addClass("active"),(e=$(".build-a-brand .wrapper-content")).find(".item").addClass("d-none"),e.find(".item[data-branding='2']").removeClass("d-none"),n("2"))},onLeaveBack:()=>{a.removeClass("active"),$(".build-a-brand .wrapper-content .item").addClass("d-none")}})}}function introBrading(){if(!(document.querySelectorAll(".build-a-brand").length<1)){gsap.registerPlugin(ScrollTrigger,SplitText);let e=document.getElementById("intro-branding"),o=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight,n()});let s=[],l={frame:0},a=0;for(let t=0;t<131;t++){let e=new Image;e.src=`./assets/images/expertise-img/img-${(t+1).toString()}.jpg`,e.onload=()=>{131===++a&&n()},e.onerror=()=>{console.error("Không tải được hình ảnh: "+e.src)},s[t]=e}function n(){var e,t,a,n,r,i;s[l.frame]&&s[l.frame].complete&&(e=s[l.frame],t=o,a=t.canvas,n=a.width/e.width,r=a.height/e.height,n=Math.max(n,r),r=(a.width-e.width*n)/2,i=(a.height-e.height*n)/2,t.clearRect(0,0,a.width,a.height),t.drawImage(e,0,0,e.width,e.height,r,i,e.width*n,e.height*n))}gsap.to(l,{frame:130,snap:"frame",ease:"none",scrollTrigger:{scrub:2,trigger:"#intro-branding",start:"top bottom",end:"bottom top"},onUpdate:n}),ScrollTrigger.create({trigger:".build-a-brand",start:"top+=5% top",onEnter:()=>{document.querySelector(".build-a-brand").classList.add("active")},onLeaveBack:()=>{document.querySelector(".build-a-brand").classList.remove("active")}}),$(".section-intro").length&&gsap.to(".section-intro",{scrollTrigger:{trigger:".section-intro",start:"top top",end:"bottom top",pin:!0,pinSpacing:!1}})}}function showCoreValue(){if(!($(".expertise-core-value").length<1)){let o=document.querySelectorAll(".content-item-lg");var e=document.querySelector(".expertise-core-value .content-ovl");if(gsap.set(e,{autoAlpha:0}),0!==o.length){o[0].classList.add("active"),Array.from(o).slice(1).forEach(e=>{e.classList.remove("active")});let n=o.length,r=.2,i=(2*n-1)*r;var t=gsap.timeline({scrollTrigger:{trigger:".expertise-core-value",start:"top top",end:"+=200%",scrub:!0,pin:!0,onUpdate:e=>{e=e.progress,e=Math.min(e*(1+i)/i,1);let a=0;var t,e=e*i;a=e<=r?e/r<.5?0:-1:(e=e-r,t=Math.floor(e/r),e=e%r/r,t<n-1?t%2==0?Math.floor(t/2)+1:(t=Math.floor(t/2)+1)===n-1||e<.5?t:-1:n-1),o.forEach((e,t)=>{t===a?e.classList.add("active"):e.classList.remove("active")})}}});t.to({},{duration:i}),t.to(e,{autoAlpha:1,duration:.5,ease:"power2.out",onStart:()=>{var e=document.querySelector(".content-bg-ovl");e&&e.classList.add("show"),effectTextCoreValue()},onReverseComplete:()=>{var e=document.querySelector(".content-bg-ovl");e&&e.classList.remove("show")}}),t.to({},{duration:.5})}}}function effectTextCoreValue(){document.querySelectorAll(".effect-heading-mask-line-core").forEach(t=>{gsap.set(t,{opacity:0});let a;SplitText.create(t,{type:"words,lines",linesClass:"line",mask:"lines",onSplit:e=>(a=gsap.fromTo(e.lines,{yPercent:100,opacity:0},{yPercent:0,opacity:1,duration:.4,stagger:.1,ease:"expo.out"}),gsap.to(a,{timeScale:.2,onStart:()=>a.play(0)}),gsap.to(t,{opacity:1,duration:0,delay:.1}),a)})}),gsap.utils.toArray(".effect-fade-content-core").forEach(e=>{var t=e.dataset.delay?parseFloat(e.dataset.delay):0;gsap.fromTo(e,{"will-change":"opacity, transform",opacity:0,y:20},{opacity:1,y:0,duration:.3,ease:"sine.out",delay:.5+t})})}let init=()=>{gsap.registerPlugin(ScrollTrigger),animateChessItems(),buildABrand(),introBrading(),showCoreValue(),ScrollTrigger.refresh()};preloadImages("img").then(()=>{init()}),$(window).on("beforeunload",function(){$(window).scrollTop(0)});