import{preloadImages}from"../../libs/utils.js";function sectionSpecialize(){if(!($(".section-specialize").length<1)){gsap.fromTo(".section-specialize .image",{scale:.5},{scale:1,scrollTrigger:{trigger:".section-specialize",start:"center bottom",end:"bottom bottom",scrub:!0},ease:"none"}),gsap.to(".specialize-main-slider",{xPercent:-160,scrollTrigger:{trigger:".section-specialize",start:"top 20%",end:"bottom 20%",scrub:!0,onEnter:()=>{$(".section-specialize").addClass("theme-light"),$("main").addClass("theme-light")},onLeaveBack:()=>{$("main").removeClass("theme-light"),$(".section-specialize").removeClass("theme-light")}},ease:"none"});let e=!1;ScrollTrigger.create({trigger:".section-specialize",start:"top 15%",once:!0,onEnter:()=>{e||($(".section-specialize .number").each(function(){$(this).find("span[data-value]").each(function(){var e=parseInt($(this).attr("data-value"))+1;$(this).css("transform",`translateY(-${100*e}%)`)})}),e=!0)}}),$(".section-specialize .number").each(function(){let i=$(this);let e=/(\D+)?(\d+(\.\d+)?)(\D+)?/.exec(i.text());e&&(e.shift(),e=e.filter(e=>null!=e),i.empty(),e.forEach(t=>{if(isNaN(t))i.append(`<span>${t}</span>`);else for(let e=0;e<t.length;e++)i.append(`
            <span data-value="${t[e]}">
              <span>&nbsp;</span>
              ${Array(parseInt(t[e])+1).join(0).split(0).map((e,t)=>`<span>${t}</span>`).join("")}
            </span>
          `)}))})}}function introChess(){if(!($(".section-intro").length<1)){let t=new Lenis,i=(t.on("scroll",()=>ScrollTrigger.update()),e=>{t.raf(1e3*e),requestAnimationFrame(i)}),e=(requestAnimationFrame(i),gsap.registerPlugin(ScrollTrigger,SplitText),document.getElementById("canvas-chess")),s=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight,g()});let a=[],l={frame:0},n=0;for(let t=0;t<74;t++){let e=new Image;e.src=`./assets/images/img-chess/chess-${(t+1).toString()}.jpg`,e.onload=()=>{74===++n&&g()},e.onerror=()=>{console.error("Không tải được hình ảnh: "+e.src)},a[t]=e}gsap.to(l,{frame:73,snap:"frame",ease:"none",scrollTrigger:{scrub:1,trigger:"#canvas-chess",start:"top+=100 bottom",end:"bottom top"},onUpdate:g});var r=document.querySelector(".section-intro-content .tag"),o=document.querySelector(".section-intro-content .h2-heading"),o=new SplitText(o,{type:"words,lines",linesClass:"line"}),c=gsap.timeline({scrollTrigger:{trigger:"#canvas-chess",start:`top+=${70/74*100}% top`,end:`top+=${70/74*100}% top`,toggleActions:"play none none reverse"}});function g(){var e,t,i,n,r,o;a[l.frame]&&a[l.frame].complete&&(e=a[l.frame],t=s,i=t.canvas,n=i.width/e.width,r=i.height/e.height,n=Math.max(n,r),r=(i.width-e.width*n)/2,o=(i.height-e.height*n)/2,t.clearRect(0,0,i.width,i.height),t.drawImage(e,0,0,e.width,e.height,r,o,e.width*n,e.height*n))}c.fromTo(r,{opacity:0,y:20},{opacity:1,y:0,duration:.4,ease:"expo.out"}),c.fromTo(o.lines,{opacity:0,yPercent:100},{opacity:1,yPercent:0,duration:.4,stagger:.1,ease:"expo.out"},"-=0.3"),gsap.to(".section-intro",{scrollTrigger:{trigger:".section-intro",start:"top top",end:"bottom top",pin:!0,pinSpacing:!1}})}}function clientInsight(){if(!($(".client-insight").length<1)){let r=document.querySelector(".client-wrapper"),o=document.querySelector(".main-section"),s=0,a=!1;o.addEventListener("mouseenter",()=>{a=!0}),o.addEventListener("mouseleave",()=>{a=!1,r.style.transform="translateX(0px)"}),o.addEventListener("mousemove",e=>{var t,i,n;e=e,a&&(t=o.offsetWidth,i=r.scrollWidth-t+80,n=o.getBoundingClientRect(),e=e.clientX-n.left,s=t-200<=e?-i:Math.min(0,e/(t-200)*i*-1),s=Math.max(-i,Math.min(0,s)),r.style.transform=`translateX(${s}px)`)})}}function sectionExpertise(){if(!($(".section-expertise").length<1)){gsap.registerPlugin(ScrollTrigger);var t=document.querySelector(".section-expertise"),i=t.querySelector(".list-item");gsap.utils.toArray(".section-expertise .item");let e=i.scrollWidth-window.innerWidth;gsap.to(i,{x:()=>`-${e}px`,ease:"none",scrollTrigger:{id:"horizontalScroll",trigger:t,start:"top top",end:()=>"+="+e,scrub:!0,pin:!0,anticipatePin:1}})}}let init=()=>{gsap.registerPlugin(ScrollTrigger),sectionSpecialize(),sectionExpertise(),introChess(),clientInsight(),ScrollTrigger.refresh()};preloadImages("img").then(()=>{init()}),$(window).on("beforeunload",function(){$(window).scrollTop(0)});