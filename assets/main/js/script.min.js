import{preloadImages}from"../../libs/utils.js";let lenis;function customDropdown(){let r=$(".dropdown-custom");r.each(function(){let t=$(this),o=t.find(".dropdown-custom__btn"),i=t.find(".dropdown-custom__menu");var e=t.find(".dropdown-custom__item");let n=t.find(".dropdown-custom__text");function s(o){$(".dropdown-custom__btn").removeClass("active"),r.each(function(){var e=$(this).find(".dropdown-custom__menu"),t=$(this).find(".dropdown-custom__btn");o&&$(this).is(o)||(e.removeClass("dropdown--active"),t.removeClass("--active"))})}o.on("click",function(e){e.stopPropagation(),s(t),i.toggleClass("dropdown--active"),o.toggleClass("--active")}),$(document).on("click",function(){s()}),e.on("click",function(e){e.stopPropagation();e=$(this);let t=n.text();var o=n.find("img").attr("src"),i=e.find("img");n.text(e.text()),i.length?(n.html(e.html()),e.hasClass("language__item")&&(t=`<span>${t}</span>`),e.html(`${o?`<img src="${o}" />`:""} `+t)):e.hasClass("language__item")&&e.text(t),s()})})}function header(){var e=$(".header-hambuger");let t=$(".header-sub-container"),o=$(".header-sub"),i=$(".header-icon-close"),n=$("body");var s=$(".header-sub-empty");e.on("click",function(){$(this).addClass("active"),o.addClass("active"),n.addClass("overflow-hidden"),setTimeout(function(){t.addClass("active")},100)}),i.on("click",function(){t.removeClass("active"),setTimeout(function(){i.removeClass("active"),o.removeClass("active"),n.removeClass("overflow-hidden")},300)}),s.on("click",function(){t.removeClass("active"),setTimeout(function(){i.removeClass("active"),o.removeClass("active"),n.removeClass("overflow-hidden")},300)})}function effectText(){gsap.registerPlugin(SplitText,ScrollTrigger),document.fonts.ready.then(()=>{document.querySelectorAll(".effect-heading-mask-line").forEach(t=>{gsap.set(t,{opacity:1});let o;SplitText.create(t,{type:"words,lines",linesClass:"line",mask:"lines",onSplit:e=>(t.classList.contains("scroll-trigger")?o=gsap.from(e.lines,{duration:.4,yPercent:100,opacity:0,stagger:.1,ease:"expo.out",scrollTrigger:{trigger:t,start:"top 60%",end:"bottom 60%",toggleActions:"play none none none"}}):(o=gsap.from(e.lines,{duration:.4,yPercent:100,opacity:0,stagger:.1,ease:"expo.out"}),gsap.to(o,{timeScale:.2,onStart:()=>o.play(0)})),o)})}),gsap.utils.toArray(".effect-fade-content").forEach(e=>{gsap.fromTo(e,{"will-change":"opacity, transform",opacity:0,y:20},{scrollTrigger:{trigger:e,start:"top 75%",end:"bottom 75%"},opacity:1,y:0,duration:.3,ease:"sine.out"})}),gsap.utils.toArray(".effect-fade-content-auto").forEach((e,t)=>{var o=parseFloat(e.dataset.delay)||.5;gsap.fromTo(e,{"will-change":"opacity, transform",opacity:0,y:20},{opacity:1,y:0,duration:.3,ease:"sine.out",delay:o,stagger:.2})}),document.querySelectorAll(".effect-heading-blur").forEach(e=>{var t=SplitText.create(e,{type:"words, chars",charsClass:"split-char",wordsClass:"split-word"});gsap.fromTo(t.chars,{filter:"blur(10px) ",y:10,willChange:"filter, transform",opacity:0},{ease:"none",filter:"blur(0px)",y:0,stagger:.05,opacity:1,scrollTrigger:{trigger:e.classList.contains("footer-effect-text")?".footer-ovl":e,start:"top 90%"}})})})}function introChess(){if(!(document.querySelectorAll(".section-intro").length<1)){let t=new Lenis,o=(t.on("scroll",()=>ScrollTrigger.update()),e=>{t.raf(1e3*e),requestAnimationFrame(o)}),e=(requestAnimationFrame(o),gsap.registerPlugin(ScrollTrigger,SplitText),document.getElementById("canvas-chess")),r=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight,d()});var s=document.querySelector(".section-intro");let i,a=(i=s.classList.contains("home")?e=>`./assets/images/img-chess/chess-${(e+1).toString()}.jpg`:s.classList.contains("about")?e=>`./assets/images/img-about/chess-${(e+1).toString()}.jpg`:e=>`./assets/images/img-chess/chess-${(e+1).toString()}.jpg`,[]),c={frame:0},n=0;for(let t=0;t<74;t++){let e=new Image;e.src=i(t),e.onload=()=>{74===++n&&d()},e.onerror=()=>{console.error("Không tải được hình ảnh: "+e.src)},a[t]=e}gsap.to(c,{frame:73,snap:"frame",ease:"none",scrollTrigger:{scrub:1,trigger:"#canvas-chess",start:"top+=100 bottom",end:"bottom top"},onUpdate:d});var s=document.querySelector(".section-intro-content .tag"),l=document.querySelector(".section-intro-content .h2-heading"),l=new SplitText(l,{type:"words,lines",linesClass:"line"}),g=gsap.timeline({scrollTrigger:{trigger:"#canvas-chess",start:`top+=${70/74*100}% top`,end:`top+=${70/74*100}% top`,toggleActions:"play none none reverse"}});function d(){var e,t,o,i,n,s;a[c.frame]&&a[c.frame].complete&&(e=a[c.frame],t=r,o=t.canvas,i=o.width/e.width,n=o.height/e.height,i=Math.max(i,n),n=(o.width-e.width*i)/2,s=(o.height-e.height*i)/2,t.clearRect(0,0,o.width,o.height),t.drawImage(e,0,0,e.width,e.height,n,s,e.width*i,e.height*i))}g.fromTo(s,{opacity:0,y:20},{opacity:1,y:0,duration:.4,ease:"expo.out"}),g.fromTo(l.lines,{opacity:0,yPercent:100},{opacity:1,yPercent:0,duration:.4,stagger:.1,ease:"expo.out"},"-=0.3"),gsap.to(".section-intro",{scrollTrigger:{trigger:".section-intro",start:"top top",end:"bottom top",pin:!0,pinSpacing:!1}})}}let init=()=>{gsap.registerPlugin(ScrollTrigger),header(),customDropdown(),effectText(),introChess()};preloadImages("img").then(()=>{init()}),$(window).on("beforeunload",function(){$(window).scrollTop(0)});