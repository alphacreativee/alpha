import*as THREE from"https://cdn.skypack.dev/three@0.129.0/build/three.module.js";import{GLTFLoader}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/GLTFLoader.js";import{DRACOLoader}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/DRACOLoader.js";import{OrbitControls}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/controls/OrbitControls.js";import{gsap}from"https://cdn.skypack.dev/gsap";import{ScrollTrigger}from"https://cdn.skypack.dev/gsap/ScrollTrigger.js";import*as dat from"https://cdn.skypack.dev/dat.gui";gsap.registerPlugin(ScrollTrigger);let camera=new THREE.PerspectiveCamera(30,window.innerWidth/window.innerHeight,.1,1e3),renderer=(camera.position.z=30,new THREE.WebGLRenderer({alpha:!0,antialias:!0})),scene=(renderer.setSize(window.innerWidth,window.innerHeight),document.getElementById("chess-3d").appendChild(renderer.domElement),new THREE.Scene),light=new THREE.AmbientLight(16777215,1),controls=(scene.add(light),new OrbitControls(camera,renderer.domElement));controls.update();let chess,loader=new GLTFLoader,dracoLoader=new DRACOLoader,arrPositionModel=(dracoLoader.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),loader.setDRACOLoader(dracoLoader),[{id:"section-specialize",position:{x:0,y:.5,z:20},rotation:{x:0,y:.56,z:0},scale:{x:1.5,y:1.5,z:1.5}}]),reRender3d=(loader.load("./assets/images/use/chess_queen.glb",function(e){(chess=e.scene).position.set(0,.5,15),chess.scale.set(.5,.5,.5),scene.add(chess);var e=new dat.GUI,t=e.addFolder("Position"),t=(t.add(chess.position,"x",-100,100).name("X"),t.add(chess.position,"y",-100,100).name("Y"),t.add(chess.position,"z",-100,100).name("Z"),t.open(),e.addFolder("Rotation")),t=(t.add(chess.rotation,"x",-Math.PI,Math.PI).name("X").step(.01),t.add(chess.rotation,"y",-Math.PI,Math.PI).name("Y").step(.01),t.add(chess.rotation,"z",-Math.PI,Math.PI).name("Z").step(.01),t.open(),e.addFolder("Scale"));t.add(chess.scale,"x",.1,3).name("X").step(.01),t.add(chess.scale,"y",.1,3).name("Y").step(.01),t.add(chess.scale,"z",.1,3).name("Z").step(.01),t.open(),arrPositionModel.forEach(e=>{gsap.timeline({scrollTrigger:{trigger:"#"+e.id,start:"top center",end:"bottom center",scrub:!0}}).to(chess.position,{x:e.position.x,y:e.position.y,z:e.position.z,ease:"power2.out"}).to(chess.rotation,{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z,ease:"power2.out"},0).to(chess.scale,{x:e.scale.x,y:e.scale.y,z:e.scale.z,ease:"power2.out"},0)}),ScrollTrigger.create({trigger:"#section-specialize",start:"top bottom",end:"bottom top",onUpdate:e=>{var e=e.progress,t=.5+.99*e,e=e*Math.PI*2;gsap.to(chess.scale,{x:t,y:t,z:t,duration:.1,overwrite:!0}),gsap.to(chess.rotation,{y:e,duration:.1,overwrite:!0})}})},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.error("Lỗi tải mô hình GLTF:",e)}),()=>{requestAnimationFrame(reRender3d),renderer.render(scene,camera)});reRender3d(),window.addEventListener("resize",()=>{renderer.setSize(window.innerWidth,window.innerHeight),camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix()});